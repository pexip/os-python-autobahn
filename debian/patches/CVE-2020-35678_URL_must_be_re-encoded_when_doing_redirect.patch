Description: CVE-2020-35678 URL must be re-encoded when doing redirect (#1439)
Author: meejah <meejah@meejah.ca>
Date: Fri, 18 Dec 2020 10:47:30 -0700
Origin: https://github.com/crossbario/autobahn-python/commit/f7b7ad5c1066bdcc551775b73da15dca5c111623.patch
Bug-Debian: https://bugs.debian.org/978416
Last-Update: 2021-06-07

Index: python-autobahn/autobahn/websocket/protocol.py
===================================================================
--- python-autobahn.orig/autobahn/websocket/protocol.py
+++ python-autobahn/autobahn/websocket/protocol.py
@@ -57,6 +57,7 @@ from autobahn.websocket.util import pars
 
 from six.moves import urllib
 import txaio
+import hyperlink
 
 if six.PY3:
     # Python 3
@@ -2600,7 +2601,8 @@ class WebSocketServerProtocol(WebSocketP
                         #
                         # https://localhost:9000/?redirect=https%3A%2F%2Ftwitter.com%2F&after=3
                         #
-                        url = self.http_request_params['redirect'][0]
+                        url = hyperlink.URL.from_text(self.http_request_params['redirect'][0])
+                        url = url.to_uri().normalize().to_text()
                         if 'after' in self.http_request_params and len(self.http_request_params['after']) > 0:
                             after = int(self.http_request_params['after'][0])
                             self.log.debug(
